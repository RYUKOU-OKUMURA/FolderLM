# MVP実装計画

## 0. 事前確認（完了済み）
- [x] 要件定義書の清書（`要件定義書_清書.md`）
- [x] アーキテクチャ清書（`アーキテクチャ清書.md`）
- [x] ノートIDの安定取得を検証（`aria-labelledby` から UUID を抽出可能）

---

## 1. DOM 調査の確定
- [ ] NotebookLM 主要ビュー（すべて/マイ/共有）で同一セレクタが使えるか確認
- [ ] ノート一覧コンテナの安定セレクタを確定
- [ ] ノートカードの安定セレクタを確定
- [ ] UI 差し込み位置（アクションバー）の安定セレクタを確定
- [ ] スクロール時の DOM 再描画/仮想スクロールの有無を確認

---

## 2. プロジェクト初期構成
- [ ] `manifest.json` を作成（MV3、storage 権限、host 権限）
- [ ] `src/content/index.js` と `content.css` を用意
- [ ] `src/storage/storageManager.js` の骨組みを作成
- [ ] `src/content/utils/` に `selectors.js`, `idParser.js`, `debounce.js` を作成
- [ ] 拡張機能を Chrome に読み込める状態にする

---

## 3. データモデルとストレージ
- [ ] データ初期値（folders / noteAssignments）を定義
- [ ] 「未分類」固定フォルダの初期化ロジック
- [ ] `storageManager.load()` の実装（バリデーション含む）
- [ ] `storageManager.save()` の実装（デバウンス）
- [ ] ストレージ容量超過時のエラーハンドリング

---

## 4. ノート検出と ID 取得
- [ ] `selectors.js` に安定セレクタを定義
- [ ] `idParser.js` に UUID 抽出ロジックを実装（`aria-labelledby`）
- [ ] フォールバックとして URL からの UUID 抽出を実装
- [ ] `noteDetector.js` でノートカードと ID のマッピングを作成
- [ ] 取得失敗時の安全停止（UI 非表示 + 通知）

---

## 5. フォルダ UI（ヘッダー）
- [ ] ヘッダーアクションバーにフォルダボタンを挿入
- [ ] フォルダドロップダウンの UI 実装
- [ ] 新規フォルダ作成 UI（バリデーション含む）
- [ ] 重複名/空文字/最大文字数の制御
- [ ] クリック外で閉じる/キーボード操作対応

---

## 6. ノート割り当て UI
- [ ] ノートカードに📁割り当てボタンを表示（ホバー時）
- [ ] フォルダ選択ポップアップの実装
- [ ] 選択結果を `noteAssignments` に反映
- [ ] 割り当て済み状態をカード上に表示

---

## 7. フィルタリング
- [ ] フォルダ選択状態の管理
- [ ] FolderLM フィルタをノート一覧に適用
- [ ] NotebookLM 標準フィルタと AND 条件で併用
- [ ] 「すべて」で FolderLM 側のみ解除

---

## 8. DOM 監視と再描画対応
- [ ] `MutationObserver` の設定
- [ ] 新規ノート追加/削除時の UI 再注入
- [ ] タブ切替/再描画後の復帰処理
- [ ] 更新処理のバッチ化（`requestAnimationFrame`）

---

## 9. アクセシビリティ/UX
- [ ] ARIA ラベル付与
- [ ] キーボード操作（フォーカス移動/決定/閉じる）
- [ ] NotebookLM の UI に合わせた余白/高さ調整

---

## 10. 手動テスト（MVP）
- [ ] フォルダ作成 → リロード後も維持
- [ ] ノート割り当て → フィルタで絞り込み確認
- [ ] フォルダ削除 → 対象ノートが未分類に戻る
- [ ] DOM 再描画後も UI が復帰する
- [ ] ID 取得失敗時に UI が安全停止する

---

## 11. MVP リリース準備
- [ ] `manifest.json` の最小権限確認
- [ ] 拡張機能の読み込み・動作確認
- [ ] MVP 機能の範囲を README などに簡潔に記載
