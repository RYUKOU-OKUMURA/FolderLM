# FolderLM 要件定義書（清書）

## 1. 概要

### プロダクト名
**FolderLM**

### コンセプト
NotebookLM のノートを仮想フォルダで整理する Chrome 拡張機能

### 解決する課題
- NotebookLM にフォルダ機能がない
- ノートが増えると目的のノートを探しにくい
- 「整理されている」という安心感がほしい

---

## 2. 目的と非目的

### 目的
- ノート一覧をフォルダで整理・絞り込みできるようにする
- NotebookLM の既存 UI に自然に溶け込む軽量な体験を提供する

### 非目的
- NotebookLM の内部 API 連携・データ構造の変更
- ノート本文やメタデータの取得・保存
- 外部サーバーへのデータ送信

---

## 3. 基本方針

### 技術的制約
- DOM 表示を操作するのみ（NotebookLM の内部データは変更しない）
- データは `chrome.storage.sync` に保存

### 設計思想
- シンプルで直感的な操作
- 既存 UI を壊さない
- 動作が重くならない

---

## 4. 機能要件

### 4.1 フォルダ管理

| 機能 | 詳細 |
| :--- | :--- |
| フォルダ作成 | 任意名で作成 |
| フォルダ編集 | 名称変更 |
| フォルダ削除 | 所属ノートは「未分類」へ移動 |
| フォルダ並び替え | DnD で順序変更（Phase 2） |

**ルール**
- 「未分類」は常に存在し、削除・名称変更不可
- フォルダ名は空不可、最大 30 文字
- 重複名は禁止（前後空白除去・大文字小文字無視）

### 4.2 ノート振り分け

| 機能 | 詳細 |
| :--- | :--- |
| フォルダ割り当て | ノートを任意フォルダに振り分け |
| 単一所属 | ノートは1つのフォルダに所属 |
| 未分類 | 未割り当ては「未分類」扱い |

### 4.3 表示フィルタリング

| 機能 | 詳細 |
| :--- | :--- |
| 全表示 | すべて表示 |
| フォルダ絞り込み | 選択フォルダのみ表示 |
| 未分類表示 | 未分類のみ表示 |

**フィルタの併用ルール**
- NotebookLM 標準フィルタ（すべて/マイ ノートブック/共有アイテム等）と **AND 条件で併用**
- FolderLM の「すべて」は FolderLM 側のみ解除

---

## 5. データ設計

### 5.1 保存場所
`chrome.storage.sync`
- 容量・書き込み制限を考慮し保存データは最小限

### 5.2 データ構造

```json
{
  "folders": [
    { "id": "folder_1", "name": "仕事用", "order": 0 }
  ],
  "noteAssignments": {
    "note_uuid_1": "folder_1"
  }
}
```

### 5.3 ノート識別方法
**安定 ID を最優先**
- ノートカード要素の `aria-labelledby` / `aria-describedby` に含まれる
  `project-<UUID>-title` 形式の UUID を利用

**フォールバック**
- ノートを開いた URL の `/notebook/<UUID>` を使用

**失敗時の挙動**
- ID が取得できない場合は UI を非表示にして通知し、機能を一時停止

---

## 6. UI/UX 設計

### 6.1 UI 配置
- ノート一覧上部のアクションバーにフォルダフィルタを追加
- 既存ボタンと高さ・余白を合わせる

### 6.2 操作フロー（要約）
- フォルダ作成: フォルダボタン → 新規作成 → 名前入力 → 確定
- 割り当て: ノートカードの📁アイコン → フォルダ選択 → 反映
- 絞り込み: フォルダボタン → 対象フォルダ選択 → 絞り込み

---

## 7. 非機能要件

### 7.1 パフォーマンス
- 一覧切替後 200ms 以内に状態反映
- 最大 1,000 ノート / 200 フォルダを目標

### 7.2 安定性
- DOM 再描画は `MutationObserver` で検知
- 既存操作を妨げない

### 7.3 障害時挙動
- DOM 変更で識別子取得失敗時は機能停止 + 通知
- 破損データは安全に初期化

### 7.4 アクセシビリティ
- キーボード操作可能
- ARIA ラベルを付与

---

## 8. セキュリティ/プライバシー

- 保存対象は「フォルダ名」と「ノートIDの割り当て」のみ
- ノート本文・タイトルは保存しない
- 外部送信なし

---

## 9. 技術スタック

| 項目 | 技術 |
| :--- | :--- |
| Manifest | V3 |
| 言語 | JavaScript（将来的に TypeScript 移行検討） |
| スタイル | CSS（NotebookLM に準拠） |
| ストレージ | `chrome.storage.sync` |
| 対象ブラウザ | Chrome / Edge（Chromium 系） |

---

## 10. 開発フェーズ

### Phase 1: MVP
- [ ] フォルダの作成・削除
- [ ] ノートのフォルダ振り分け
- [ ] フォルダによるフィルタリング表示
- [ ] `chrome.storage` への保存/読み込み
- [ ] ノートID取得の安定性検証

### Phase 2: 改善
- [ ] フォルダ名の編集
- [ ] フォルダの並び替え
- [ ] UI 微調整

### Phase 3: 拡張
- [ ] インポート / エクスポート
- [ ] 検索機能との連携
- [ ] フォルダにカラー/アイコン設定
